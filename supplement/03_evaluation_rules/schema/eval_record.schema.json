{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prompt-drift-lab/schema/eval_record.json",
  "title": "Prompt Drift Lab - Eval Record (Structure Only)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "eval_id",
    "run_id",
    "created_at",
    "protocol_version",
    "judge_model",
    "generator_model",
    "question_id",
    "prompt_version",
    "length_variant",
    "instruction_variant",
    "per_file_scores"
  ],
  "properties": {
    "eval_id": {
      "type": "string",
      "description": "Evaluation record identifier."
    },
    "run_id": {
      "type": "string",
      "description": "Run identifier."
    },
    "created_at": {
      "type": "string",
      "description": "Creation timestamp as a string."
    },
    "protocol_version": {
      "type": "string",
      "description": "Protocol identifier as a string."
    },
    "judge_prompt_version": {
      "type": "string",
      "description": "Judge prompt version tag as a string."
    },
    "judge_model": {
      "type": "string",
      "description": "Judge model identifier as a string."
    },
    "generator_model": {
      "type": "string",
      "description": "Generator model identifier as a string."
    },
    "question_id": {
      "type": "string",
      "description": "Question identifier as a string."
    },
    "prompt_version": {
      "type": "string",
      "description": "Prompt version identifier as a string."
    },
    "length_variant": {
      "type": "string",
      "description": "Length variant identifier as a string."
    },
    "instruction_variant": {
      "type": "string",
      "description": "Instruction variant identifier as a string."
    },
    "source_artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "path"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Artifact type as a string."
        },
        "path": {
          "type": "string",
          "description": "Artifact path as a string."
        },
        "sha256": {
          "type": "string",
          "description": "Checksum as a string."
        }
      },
      "description": "Pointer to an evaluated artifact."
    },

    "per_file_scores": {
      "type": "array",
      "description": "Per-file evaluation entries.",
      "items": { "$ref": "#/$defs/per_file_score" }
    },

    "bundle_meta": {
      "type": "object",
      "description": "Optional metadata object.",
      "additionalProperties": true
    }
  },

  "$defs": {
    "per_file_score": {
      "type": "object",
      "additionalProperties": false,
      "required": ["file", "scores"],
      "properties": {
        "file": {
          "type": "string",
          "description": "Evaluated file identifier as a string."
        },
        "scores": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "A_structure",
            "B_snapshot_constraint",
            "C_actionability",
            "D_completeness",
            "E_drift_failure"
          ],
          "properties": {
            "A_structure": { "type": "number" },
            "B_snapshot_constraint": { "type": "number" },
            "C_actionability": { "type": "number" },
            "D_completeness": { "type": "number" },
            "E_drift_failure": { "type": "number" }
          },
          "description": "Score fields (numbers only)."
        },
        "total": {
          "type": "number",
          "description": "Optional total score as a number."
        },
        "evidence": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "A_structure": { "type": "string" },
            "B_snapshot_constraint": { "type": "string" },
            "C_actionability": { "type": "string" },
            "D_completeness": { "type": "string" },
            "E_drift_failure": { "type": "string" }
          },
          "description": "Optional evidence strings."
        }
      }
    }
  }
}