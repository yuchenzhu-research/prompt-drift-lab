{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prompt-drift-lab/schema/eval_record.json",
  "title": "Prompt Drift Lab - Eval Record (Single Evaluated Output)",
  "description": "Schema for a single evaluation record. One judge evaluates one generated output and produces one set of scores.",
  "type": "object",
  "additionalProperties": false,

  "properties": {
    "eval_id": {
      "type": "string",
      "description": "Unique identifier for this evaluation record."
    },
    "run_id": {
      "type": "string",
      "description": "Identifier of the experimental run this record belongs to."
    },
    "created_at": {
      "type": "string",
      "description": "Timestamp when this evaluation record was created (ISO 8601 recommended)."
    },
    "protocol_version": {
      "type": "string",
      "description": "Version identifier of the evaluation protocol used."
    },

    "judge_prompt_version": {
      "type": "string",
      "description": "Version identifier of the judge prompt."
    },
    "judge_model": {
      "type": "string",
      "description": "Model identifier of the judge LLM."
    },
    "generator_model": {
      "type": "string",
      "description": "Model identifier of the evaluated (generator) LLM."
    },

    "question_id": {
      "type": "string",
      "description": "Identifier of the evaluation question."
    },
    "prompt_version": {
      "type": "string",
      "description": "Identifier of the prompt variant used for generation."
    },
    "length_variant": {
      "type": "string",
      "description": "Length-related variant identifier (e.g., short / long)."
    },
    "instruction_variant": {
      "type": "string",
      "description": "Instruction-related variant identifier."
    },

    "source_artifact": {
      "type": "object",
      "description": "Reference to the source artifact being evaluated.",
      "additionalProperties": false,
      "required": ["type", "path"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the source artifact (e.g., file, text, json)."
        },
        "path": {
          "type": "string",
          "description": "Path or identifier of the source artifact."
        },
        "sha256": {
          "type": "string",
          "description": "Optional SHA-256 checksum of the source artifact."
        }
      }
    },

    "scores": {
      "type": "object",
      "description": "Evaluation scores assigned by the judge for this single output.",
      "additionalProperties": false,
      "required": [
        "A_structure",
        "B_snapshot_constraint",
        "C_actionability",
        "D_completeness",
        "E_drift_failure"
      ],
      "properties": {
        "A_structure": {
          "type": "number",
          "enum": [0, 1, 2],
          "description": "Structural compliance score."
        },
        "B_snapshot_constraint": {
          "type": "number",
          "enum": [0, 1, 2],
          "description": "Snapshot length and constraint compliance score."
        },
        "C_actionability": {
          "type": "number",
          "enum": [0, 1, 2],
          "description": "Actionability score."
        },
        "D_completeness": {
          "type": "number",
          "enum": [0, 1, 2],
          "description": "Completeness score."
        },
        "E_drift_failure": {
          "type": "number",
          "enum": [0, 1, 2],
          "description": "Drift or failure-related score."
        }
      }
    },

    "evidence": {
      "type": "object",
      "description": "Optional textual evidence or justification provided by the judge.",
      "additionalProperties": false,
      "properties": {
        "A_structure": { "type": "string" },
        "B_snapshot_constraint": { "type": "string" },
        "C_actionability": { "type": "string" },
        "D_completeness": { "type": "string" },
        "E_drift_failure": { "type": "string" }
      }
    },

    "bundle_meta": {
      "type": "object",
      "description": "Optional metadata carried over from upstream pipelines. Not used for scoring or validity.",
      "additionalProperties": true
    }
  },

  "required": [
    "eval_id",
    "run_id",
    "created_at",
    "protocol_version",
    "judge_model",
    "generator_model",
    "question_id",
    "prompt_version",
    "length_variant",
    "instruction_variant",
    "scores"
  ]
}