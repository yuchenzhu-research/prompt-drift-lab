# Prompt Drift Lab — 实验协议（与现有跑出来的结果对齐版）
# 文件：01_实验设计/实验协议.yaml
# 对齐依据：本仓库已有的 16 份评测产物与其汇总 JSON（见 judge_chatgpt_bundle_gemini_v2.json）。
# 原则：只写“已经发生/已经评测”的内容；不额外扩展未来想做但还没跑的配置项。

protocol_meta:
  protocol_id: EVAL_PROTOCOL_v2
  protocol_version: v2
  last_updated: 2025-12-24
  language: zh-CN

# 评测对象（已跑的实验）
experiment:
  bundle:
    bundle_size: 16
    questions: [Q3, Q4]
    versions: [baseline, long, weak, conflict]
    trigger_types: [implicit, explicit]
    # 产物命名约定（来自现有文件名）
    file_name_template: "q{question_id} {version} {trigger_type}.pdf"

# 目标输出格式（被评测的“三段式”）
required_output_format:
  # 必须按以下顺序出现；缺失或顺序错视为结构失败。
  sections_in_order:
    - "[事实快照]"
    - "[ChatGPT 联网搜索指令]"
    - "[Gemini 深度挖掘指令]"
  # 事实快照的约束（来自现有扣分点）
  snapshot_constraints:
    max_chars: 50
    must_be_factual: true
    must_not_include:
      - "因果解释"
      - "延伸分析"

# 评分维度（与现有打分字段一致）
scoring:
  scale: {min: 0, max: 2}
  dimensions:
    A_structure:
      definition: "是否按三段式输出，并保持顺序正确、段落清晰。"
      score_2: "三段式齐全，顺序正确，段落清晰。"
      score_1: "三段式基本齐全但存在明显结构瑕疵（如顺序轻微错乱/标题不规范/段落混杂）。"
      score_0: "未按三段式输出（或三段式仅出现在后文模板/建议中）。"

    B_snapshot_constraint:
      definition: "[事实快照] 是否满足 ≤50 字且不夹带解释/因果。"
      score_2: "≤50 字，纯事实描述，无解释/因果。"
      score_1: "出现以下任一：>50 字；或包含解释/因果。"
      score_0: "未提供事实快照或完全偏离该段要求。"

    C_actionability:
      definition: "[ChatGPT 联网搜索指令] 是否可直接拿去用（明确任务、强制联网、产出形态/引用要求）。"
      score_2: "指令清晰可执行：要求联网检索；说明产出（简报/表格/引用）。"
      score_1: "可执行但约束不够强（如未明确联网/引用/产出结构）。"
      score_0: "不可执行或与任务无关。"

    D_completeness:
      definition: "[Gemini 深度挖掘指令] 是否覆盖机制解释 + 结构化产出 + 实验/诊断建议。"
      score_2: "覆盖：机制点（如对齐/解码/上下文/冲突）+ 对照表/决策树等结构化产出 + 可复现实验建议。"
      score_1: "覆盖不全（缺机制/缺结构化产出/缺实验建议之一）。"
      score_0: "不可执行或与任务无关。"

    E_drift_failure:
      definition: "是否发生明显‘漂移失败’（如任务重解释为诊断长文、结构崩坏等）。"
      score_2: "无明显漂移失败；即便存在少量前导文本，仍完成三段式且主体未跑偏。"
      score_1: "存在漂移迹象（明显前导分析/插入额外结构），但三段式仍可辨认。"
      score_0: "漂移失败：输出退化为诊断/分析文本，三段式缺失或不可辨认。"

# 证据记录（与现有 evidence 字段对齐）
evidence_capture:
  required: true
  per_dimension_evidence: true
  extra_signals:
    # 现有产物里出现了该信号（用于记录，不强行当作硬阈值）。
    preamble_nonspace_chars: true

# 汇总输出（与现有 judge_chatgpt_bundle_gemini_v2.json 的结构一致）
report_schema:
  top_level_fields:
    - bundle_meta
    - per_file_scores
    - aggregates
    - final_notes
  per_file_scores_fields:
    - file
    - scores
    - total
    - evidence
    - notes

# 已观测到的稳定现象（仅复述现有汇总，不额外推断）
observations_from_current_run:
  implicit_vs_explicit:
    implicit:
      observed: "8/8 未按三段式输出（按协议计 0 分）。"
    explicit:
      observed: "8/8 完成三段式；主要扣分集中在事实快照>50字或包含因果/解释。"
